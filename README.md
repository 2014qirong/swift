# swift

Swift 有如下几个特点：
1 极高的数据z持久性
2 各个存储节点完全对等，对称的结构
3 因为是对称的系统结构，扩容时只需要简单的增加机器，扩展性好
4 不存在单点故障，各个节点完全对等，没有所谓的主从结构

必须面对的一个问题就是如何保持数据的一致性，Swift有三个服务来解决这个问题：Auditor update replicator.Auditor运行在每个swift服务器的后台来持续的扫描磁盘来检测数据的完整性。如果发现数据损坏，Auditor就会将该文件u移动到隔离区，然后又replicator负责用一个完好地copy来替代该文件。如果更新失败，该次更新咋本次系统上会被加入f队列，然后Update会继续处理这些失败的更新。

Swift没有元数据服务器，也就是说，不会特意为每一个文件生成一个类似innode的东西，v并且保存到特定的一个服务器上。那么是用什么策略来完成决定存储到那个storage node上的呢？

object中包含了 object OID data metadata atributes
可以看出，在对象存储中。存储的不仅仅是数据，还有与丰富的数据先关的属性信息。系统会给每一个对象分配一个唯一的ID，对象本身是平等的，所有的ID 属于一个平坦的地址空间，而并非文件系统那样的树桩逻辑结构。

这种存储结构带来的好处就是可以实现数据的智能化管理，因为对象本身包含了元数据信息 甚至更多的属性，我们可以根据信息对对象进行高效的管理，设计存储策略 priority 。
根据一致性hash算法实现数据的存储。
一致性hash算法的基本实现是将机器的节点和KEY值按照一样的hash算法映射到一个0~2^32的圆环上，当一个写入的缓存请求到来时，计算key 值得到hash(k)，如果该值正好对应之前的某个机器的hash值，则直接写入该机器节点，如果么有则顺时针查找下一个节点，进行写入。

一致性算法满足了单调性和负载均衡的特性以及一般hash算法的分散性，但是这还不能够当做其被g广泛利用的原由，因为缺少了平衡性。在一致性hash 算法中，为了尽可能满足平衡性，我们引入虚拟节点：

-----虚拟节点实际上是在hash空间的复制品（replica），一个实际节点机器对应多个虚拟节点，这个对应个数也成为复制个数，“虚拟节点”在hash空间以hash值排列。
